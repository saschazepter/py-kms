{% extends 'base.html' %}

{% block title %}Clients{% endblock %}

{% block content %}
<nav class="level">
    <div class="level-item has-text-centered">
        <div>
            <p class="heading">Products</p>
            <p class="title">{{ count_products + filtered }}</p>
        </div>
    </div>
    <div class="level-item has-text-centered">
        <div>
            <p class="heading">Windows</p>
            <p class="title">{{ count_products_windows }}</p>
        </div>
    </div>
    <div class="level-item has-text-centered">
        <div>
            <p class="heading">Office</p>
            <p class="title">{{ count_products_office }}</p>
        </div>
    </div>
    <div class="level-item has-text-centered">
        <div>
            <p class="heading"><abbr title="Empty GLVK or not recognized">Other</abbr></p>
            <p class="title">{{ filtered }}</p>
        </div>
    </div>
</nav>

<hr>

<!-- Search Input -->
<div class="field">
    <div class="control">
        <input class="input" type="text" id="search" placeholder="Search by Name" />
    </div>
</div>

<!-- Table -->
<table class="table is-bordered is-striped is-hoverable is-fullwidth">
    <thead>
        <tr>
            <th>Name</th>
            <th><abbr title="Group Volume License Key">GVLK</abbr></th>
        </tr>
    </thead>
    <tbody id="product-table-body">
        {% for name, gvlk in products | dictsort %}
        {% if gvlk %}
        <tr>
            <td class="product-name">{{ name }}</td>
            <td>
                <div style="position: relative; display: flex; align-items: center;">
                    <pre class="gvlk-value">{{ gvlk }}</pre>
                    <button class="button is-small ml-3" title="Copy to clipboard"
                        onclick="copyClick(this, '{{ gvlk }}');">
                        üìã
                    </button>
                </div>
            </td>
        </tr>
        {% endif %}
        {% endfor %}
    </tbody>
</table>

<script>
    // Clipboard copy functionality
    function copyClick(button, gvlk) {
        navigator.clipboard.writeText(gvlk).then(function () {
            button.classList.add('is-success');
            button.textContent = '‚úÖ';
            console.log('GVLK copied to clipboard: ' + gvlk);
        }, function (err) {
            button.classList.add('is-danger');
            button.textContent = '‚ö†Ô∏è';
            alert('Could not copy "' + gvlk + '" to clipboard: ' + err);
        });
        // reset the color after a few seconds
        setTimeout(function () {
            button.classList.remove('is-success', 'is-danger');
            button.textContent = 'üìã';
        }, 3000);
    }

    // Search functionality
    document.getElementById('search').addEventListener('input', function () {
        var searchValue = this.value.toLowerCase();
        var rows = document.querySelectorAll('#product-table-body tr');

        rows.forEach(function (row) {
            var nameCell = row.querySelector('.product-name');
            var nameText = nameCell.textContent.toLowerCase();

            if (nameText.includes(searchValue)) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        });
    });
</script>
{% endblock %}
